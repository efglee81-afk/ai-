<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>클래식 작곡가 맞추기 게임</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 0.95em;
            color: #666;
        }

        .difficulty-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .diff-btn {
            padding: 8px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .diff-btn:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .diff-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 3px;
        }

        .info-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 25px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            width: 0%;
        }

        .music-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
            color: white;
        }

        .music-title {
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .current-piece {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 20px;
            min-height: 20px;
        }

        .music-visualizer {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 60px;
            gap: 4px;
            margin: 20px 0;
        }

        .bar {
            width: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            transition: all 0.3s;
        }

        .bar:nth-child(1) { height: 25px; }
        .bar:nth-child(2) { height: 40px; }
        .bar:nth-child(3) { height: 30px; }
        .bar:nth-child(4) { height: 45px; }
        .bar:nth-child(5) { height: 35px; }
        .bar:nth-child(6) { height: 42px; }
        .bar:nth-child(7) { height: 28px; }

        .music-visualizer.active .bar {
            background: white;
            animation: wave 0.8s ease-in-out infinite;
        }

        .bar:nth-child(1) { animation-delay: 0s; }
        .bar:nth-child(2) { animation-delay: 0.1s; }
        .bar:nth-child(3) { animation-delay: 0.2s; }
        .bar:nth-child(4) { animation-delay: 0.3s; }
        .bar:nth-child(5) { animation-delay: 0.4s; }
        .bar:nth-child(6) { animation-delay: 0.5s; }
        .bar:nth-child(7) { animation-delay: 0.6s; }

        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.8); }
        }

        .music-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .control-btn.playing {
            background: #ffd93d;
            color: #333;
        }

        .hint-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hint-text {
            color: #92400e;
            font-size: 0.95em;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option-card:hover:not(.disabled) {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
            background: #f8f8ff;
        }

        .option-card.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
            animation: correct 0.6s;
        }

        .option-card.wrong {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
            animation: wrong 0.5s;
        }

        @keyframes correct {
            50% { transform: scale(1.08); }
        }

        @keyframes wrong {
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .option-card.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .card-composer {
            font-size: 1.15em;
            font-weight: 700;
        }

        .card-period {
            font-size: 0.75em;
            color: #999;
            margin-top: 5px;
        }

        .option-card.correct .card-period,
        .option-card.wrong .card-period {
            color: rgba(255, 255, 255, 0.9);
        }

        .bottom-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-hint {
            background: #f59e0b;
            color: white;
        }

        .btn-next {
            background: #10b981;
            color: white;
            display: none;
        }

        .btn-next.show {
            display: inline-block;
        }

        .btn-reset {
            background: #ef4444;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            width: 90%;
        }

        .modal-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .modal-emoji {
            font-size: 4em;
            margin: 20px 0;
        }

        .modal-score {
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">🎼 클래식 작곡가 맞추기</h1>
            <p class="subtitle">음악을 듣고 작곡가를 맞춰보세요</p>
        </div>

        <div class="difficulty-container">
            <button class="diff-btn active" data-level="easy">🎵 쉬움 (5문제)</button>
            <button class="diff-btn" data-level="normal">🎶 보통 (8문제)</button>
            <button class="diff-btn" data-level="hard">🎼 어려움 (10문제)</button>
        </div>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">문제</div>
                <div class="info-value"><span id="currentNum">1</span>/<span id="totalNum">5</span></div>
            </div>
            <div class="info-item">
                <div class="info-label">정답</div>
                <div class="info-value" id="correctNum">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">힌트</div>
                <div class="info-value" id="hintNum">3</div>
            </div>
            <div class="info-item">
                <div class="info-label">점수</div>
                <div class="info-value" id="scoreNum">0</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="music-section">
            <div class="music-title" id="musicTitle">🎵 음악을 재생해보세요</div>
            <div class="current-piece" id="currentPiece"></div>
            
            <div class="music-visualizer" id="visualizer">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>

            <div class="music-controls">
                <button class="control-btn" id="playBtn" onclick="playMusic()">
                    <span>▶️</span>
                    <span>음악 재생</span>
                </button>
                <button class="control-btn" id="stopBtn" onclick="stopMusic()">
                    <span>⏹️</span>
                    <span>정지</span>
                </button>
            </div>
        </div>

        <div class="hint-box" id="hintBox">
            <div class="hint-text" id="hintText"></div>
        </div>

        <div class="options-grid" id="optionsGrid"></div>

        <div class="bottom-controls">
            <button class="btn btn-hint" id="hintBtn" onclick="showHint()">💡 힌트</button>
            <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">다음 →</button>
            <button class="btn btn-reset" onclick="resetGame()">🔄 새 게임</button>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2 class="modal-title">🎉 게임 완료!</h2>
            <div class="modal-emoji" id="gradeEmoji">🏆</div>
            <div class="modal-score">
                최종 점수: <strong id="finalScore">0</strong>점<br>
                정답률: <span id="accuracy">0</span>%
            </div>
            <div class="modal-message" id="gradeMessage">훌륭합니다!</div>
            <button class="btn btn-reset" onclick="resetGame()">다시 도전</button>
        </div>
    </div>

    <script>
        const musicDB = {
            easy: [
                {
                    composer: "베토벤",
                    piece: "운명 교향곡",
                    period: "고전-낭만",
                    hint: "독일 작곡가, 청각을 잃었지만 위대한 작품을 남김",
                    melody: [
                        {note: 349, dur: 200}, {note: 349, dur: 200}, {note: 349, dur: 200}, 
                        {note: 277, dur: 600}, {note: 311, dur: 200}, {note: 311, dur: 200},
                        {note: 311, dur: 200}, {note: 277, dur: 600}
                    ]
                },
                {
                    composer: "모차르트",
                    piece: "아이네 클라이네 나흐트무지크",
                    period: "고전주의",
                    hint: "오스트리아 천재 작곡가, 35세에 요절",
                    melody: [
                        {note: 392, dur: 300}, {note: 294, dur: 150}, {note: 392, dur: 300},
                        {note: 294, dur: 150}, {note: 392, dur: 150}, {note: 294, dur: 150},
                        {note: 392, dur: 150}, {note: 494, dur: 150}, {note: 587, dur: 400}
                    ]
                },
                {
                    composer: "바흐",
                    piece: "G선상의 아리아",
                    period: "바로크",
                    hint: "음악의 아버지, 독일 바로크 시대의 거장",
                    melody: [
                        {note: 392, dur: 800}, {note: 440, dur: 400}, {note: 494, dur: 400},
                        {note: 523, dur: 400}, {note: 587, dur: 800}, {note: 523, dur: 400},
                        {note: 494, dur: 400}, {note: 440, dur: 800}
                    ]
                },
                {
                    composer: "비발디",
                    piece: "사계 - 봄",
                    period: "바로크",
                    hint: "이탈리아 작곡가, 붉은 머리 사제",
                    melody: [
                        {note: 659, dur: 200}, {note: 587, dur: 200}, {note: 523, dur: 200},
                        {note: 587, dur: 200}, {note: 659, dur: 200}, {note: 659, dur: 200},
                        {note: 659, dur: 400}, {note: 587, dur: 200}, {note: 523, dur: 200}
                    ]
                },
                {
                    composer: "파헬벨",
                    piece: "캐논 D장조",
                    period: "바로크",
                    hint: "독일 바로크 작곡가, 결혼식 단골곡",
                    melody: [
                        {note: 587, dur: 400}, {note: 494, dur: 400}, {note: 523, dur: 400},
                        {note: 440, dur: 400}, {note: 392, dur: 400}, {note: 392, dur: 400},
                        {note: 440, dur: 400}, {note: 523, dur: 400}
                    ]
                }
            ],
            normal: [
                {
                    composer: "쇼팽",
                    piece: "녹턴 제2번",
                    period: "낭만주의",
                    hint: "폴란드 출신, 피아노의 시인",
                    melody: [
                        {note: 494, dur: 600}, {note: 523, dur: 200}, {note: 494, dur: 200},
                        {note: 466, dur: 200}, {note: 440, dur: 400}, {note: 392, dur: 400},
                        {note: 349, dur: 600}, {note: 392, dur: 200}
                    ]
                },
                {
                    composer: "드뷔시",
                    piece: "달빛",
                    period: "인상주의",
                    hint: "프랑스 인상주의 음악의 창시자",
                    melody: [
                        {note: 330, dur: 600}, {note: 349, dur: 300}, {note: 392, dur: 300},
                        {note: 440, dur: 600}, {note: 392, dur: 300}, {note: 349, dur: 300},
                        {note: 330, dur: 800}
                    ]
                },
                {
                    composer: "브람스",
                    piece: "헝가리 무곡 5번",
                    period: "낭만주의",
                    hint: "독일 작곡가, 베토벤의 계승자",
                    melody: [
                        {note: 440, dur: 200}, {note: 494, dur: 200}, {note: 523, dur: 200},
                        {note: 494, dur: 200}, {note: 440, dur: 400}, {note: 392, dur: 200},
                        {note: 440, dur: 200}, {note: 349, dur: 400}
                    ]
                }
            ],
            hard: [
                {
                    composer: "라흐마니노프",
                    piece: "피아노 협주곡 2번",
                    period: "후기낭만",
                    hint: "러시아 작곡가, 거대한 손의 소유자",
                    melody: [
                        {note: 262, dur: 400}, {note: 294, dur: 400}, {note: 330, dur: 400},
                        {note: 349, dur: 400}, {note: 392, dur: 600}, {note: 349, dur: 200},
                        {note: 330, dur: 200}, {note: 294, dur: 600}
                    ]
                },
                {
                    composer: "사티",
                    piece: "짐노페디 1번",
                    period: "근현대",
                    hint: "프랑스 작곡가, 단순미의 추구",
                    melody: [
                        {note: 440, dur: 1000}, {note: 440, dur: 500}, {note: 392, dur: 1000},
                        {note: 392, dur: 500}, {note: 349, dur: 1000}, {note: 330, dur: 1000},
                        {note: 294, dur: 1500}
                    ]
                }
            ]
        };

        let gameState = {
            difficulty: 'easy',
            currentIndex: 0,
            questions: [],
            score: 0,
            correctCount: 0,
            hintsRemaining: 3,
            answered: false,
            audioContext: null,
            isPlaying: false,
            currentMelody: null
        };

        function init() {
            document.querySelectorAll('.diff-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    gameState.difficulty = this.dataset.level;
                    resetGame();
                });
            });
            
            resetGame();
        }

        function resetGame() {
            stopMusic();
            gameState.currentIndex = 0;
            gameState.score = 0;
            gameState.correctCount = 0;
            gameState.hintsRemaining = 3;
            gameState.answered = false;

            const pool = gameState.difficulty === 'easy' ? musicDB.easy :
                        gameState.difficulty === 'normal' ? [...musicDB.easy, ...musicDB.normal] :
                        [...musicDB.easy, ...musicDB.normal, ...musicDB.hard];
            
            const count = gameState.difficulty === 'easy' ? 5 : 
                         gameState.difficulty === 'normal' ? 8 : 10;
            
            gameState.questions = shuffle(pool).slice(0, count);

            document.getElementById('hintBox').classList.remove('show');
            document.getElementById('nextBtn').classList.remove('show');
            document.getElementById('resultModal').classList.remove('show');
            document.getElementById('hintBtn').disabled = false;
            document.getElementById('currentPiece').textContent = '';

            updateUI();
            loadQuestion();
        }

        function loadQuestion() {
            if (gameState.currentIndex >= gameState.questions.length) {
                showResults();
                return;
            }

            gameState.answered = false;
            document.getElementById('musicTitle').textContent = '🎵 음악을 재생해보세요';
            document.getElementById('currentPiece').textContent = '';
            document.getElementById('hintBox').classList.remove('show');
            document.getElementById('nextBtn').classList.remove('show');
            document.getElementById('visualizer').classList.remove('active');

            createOptions(gameState.questions[gameState.currentIndex]);
            updateUI();
        }

        function createOptions(correct) {
            const all = [...musicDB.easy, ...musicDB.normal, ...musicDB.hard];
            const composers = [...new Set(all.map(m => m.composer))];
            const wrongComposers = shuffle(composers.filter(c => c !== correct.composer)).slice(0, 3);
            const options = shuffle([correct.composer, ...wrongComposers]);

            const container = document.getElementById('optionsGrid');
            container.innerHTML = '';

            options.forEach(composer => {
                const musicData = all.find(m => m.composer === composer);
                const card = document.createElement('div');
                card.className = 'option-card';
                card.innerHTML = `
                    <div class="card-composer">${composer}</div>
                    <div class="card-period">${musicData.period}</div>
                `;
                card.onclick = () => selectAnswer(composer);
                container.appendChild(card);
            });
        }

        function playMusic() {
            if (gameState.isPlaying) return;
            
            if (!gameState.audioContext) {
                gameState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const question = gameState.questions[gameState.currentIndex];
            gameState.isPlaying = true;
            
            document.getElementById('visualizer').classList.add('active');
            document.getElementById('playBtn').classList.add('playing');
            document.getElementById('musicTitle').textContent = '🎧 음악을 듣고 작곡가를 맞춰보세요';
            document.getElementById('currentPiece').textContent = '재생 중...';
            
            playMelody(question.melody);
        }

        function playMelody(melody) {
            let time = gameState.audioContext.currentTime;
            
            melody.forEach(note => {
                const osc = gameState.audioContext.createOscillator();
                const gain = gameState.audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(gameState.audioContext.destination);
                
                osc.frequency.value = note.note;
                osc.type = 'sine';
                
                gain.gain.setValueAtTime(0, time);
                gain.gain.linearRampToValueAtTime(0.3, time + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.01, time + note.dur/1000);
                
                osc.start(time);
                osc.stop(time + note.dur/1000);
                
                time += note.dur/1000;
            });
            
            setTimeout(() => stopMusic(), time * 1000 - gameState.audioContext.currentTime * 1000);
        }

        function stopMusic() {
            gameState.isPlaying = false;
            document.getElementById('visualizer').classList.remove('active');
            document.getElementById('playBtn').classList.remove('playing');
            document.getElementById('currentPiece').textContent = '';
        }

        function selectAnswer(selected) {
            if (gameState.answered) return;

            gameState.answered = true;
            const correct = gameState.questions[gameState.currentIndex];
            const isCorrect = selected === correct.composer;

            stopMusic();

            document.querySelectorAll('.option-card').forEach(card => {
                const composer = card.querySelector('.card-composer').textContent;
                card.classList.add('disabled');
                
                if (composer === correct.composer) {
                    card.classList.add('correct');
                } else if (composer === selected && !isCorrect) {
                    card.classList.add('wrong');
                }
            });

            if (isCorrect) {
                gameState.correctCount++;
                gameState.score += 100 - ((3 - gameState.hintsRemaining) * 20);
                document.getElementById('musicTitle').textContent = '✅ 정답입니다!';
                document.getElementById('currentPiece').textContent = `${correct.composer}의 「${correct.piece}」`;
            } else {
                document.getElementById('musicTitle').textContent = '❌ 틀렸습니다!';
                document.getElementById('currentPiece').textContent = `정답: ${correct.composer}의 「${correct.piece}」`;
            }

            document.getElementById('nextBtn').classList.add('show');
            updateUI();
        }

        function showHint() {
            if (gameState.hintsRemaining <= 0 || gameState.answered) return;

            gameState.hintsRemaining--;
            const hint = gameState.questions[gameState.currentIndex].hint;
            
            document.getElementById('hintText').textContent = `💡 ${hint}`;
            document.getElementById('hintBox').classList.add('show');
            
            if (gameState.hintsRemaining === 0) {
                document.getElementById('hintBtn').disabled = true;
            }
            
            updateUI();
        }

        function nextQuestion() {
            gameState.currentIndex++;
            gameState.hintsRemaining = 3;
            document.getElementById('hintBtn').disabled = false;
            loadQuestion();
        }

        function updateUI() {
            document.getElementById('currentNum').textContent = gameState.currentIndex + 1;
            document.getElementById('totalNum').textContent = gameState.questions.length;
            document.getElementById('correctNum').textContent = gameState.correctCount;
            document.getElementById('hintNum').textContent = gameState.hintsRemaining;
            document.getElementById('scoreNum').textContent = gameState.score;
            
            const progress = (gameState.currentIndex / gameState.questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function showResults() {
            const accuracy = Math.round((gameState.correctCount / gameState.questions.length) * 100);
            
            let emoji = '🏆', message = '완벽한 클래식 마스터!';
            if (accuracy < 90) emoji = '🥈', message = '훌륭한 실력!';
            if (accuracy < 70) emoji = '🥉', message = '좋은 도전!';
            if (accuracy < 50) emoji = '💪', message = '다시 도전해보세요!';
            
            document.getElementById('gradeEmoji').textContent = emoji;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('accuracy').textContent = accuracy;
            document.getElementById('gradeMessage').textContent = message;
            document.getElementById('resultModal').classList.add('show');
        }

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        window.onload = init;
    </script>
</body>
</html>
